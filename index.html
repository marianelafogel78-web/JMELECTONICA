<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JM.ELECTRONICA</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        /* Estilos base de Tailwind (no tocar) */
        *,
        ::before,
        ::after {
            --tw-border-spacing-x: 0;
            --tw-border-spacing-y: 0;
            --tw-translate-x: 0;
            --tw-translate-y: 0;
            --tw-rotate: 0;
            --tw-skew-x: 0;
            --tw-skew-y: 0;
            --tw-scale-x: 1;
            --tw-scale-y: 1;
            --tw-pan-x:;
            --tw-pan-y:;
            --tw-pinch-zoom:;
            --tw-scroll-snap-strictness: proximity;
            --tw-gradient-from-position:;
            --tw-gradient-via-position:;
            --tw-gradient-to-position:;
            --tw-ordinal:;
            --tw-slashed-zero:;
            --tw-numeric-figure:;
            --tw-numeric-spacing:;
            --tw-numeric-fraction:;
            --tw-ring-inset:;
            --tw-ring-offset-width: 0px;
            --tw-ring-offset-color: #fff;
            --tw-ring-color: rgb(59 130 246 / 0.5);
            --tw-ring-offset-shadow: 0 0 #0000;
            --tw-ring-shadow: 0 0 #0000;
            --tw-shadow: 0 0 #0000;
            --tw-shadow-colored: 0 0 #0000;
            --tw-blur:;
            --tw-brightness:;
            --tw-contrast:;
            --tw-grayscale:;
            --tw-hue-rotate:;
            --tw-invert:;
            --tw-saturate:;
            --tw-sepia:;
            --tw-drop
        }

        /* Estilos espec√≠ficos para el formulario de administraci√≥n */
        #product-form input,
        #product-form textarea {
            display: block;
            width: 100%;
            margin-bottom: 10px;
            padding: 8px;
            box-sizing: border-box;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        #admin-products-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        #admin-products-table th,
        #admin-products-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        /* Ocultar las vistas no activas */
        .app-view {
            display: none;
        }

        /* === ESTILOS DE MARCA JM.ELECTRONICA === */
        /* Estilo para el Encabezado del Cat√°logo */
        #catalog-header {
            background-color: #e0f2f1;
            /* Fondo verde azulado suave */
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        /* Estilo para el t√≠tulo JM.ELECTRONICA */
        #catalog-header h1 {
            font-size: 2.5rem;
            /* Letra m√°s grande */
            color: #00796b;
            /* Color verde azulado oscuro */
            font-weight: 800;
            /* Extra bold */
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
            /* Sombra sutil */
        }

        /* Estilo para los botones de Categor√≠a (Filtros) */
        #category-filters button {
            /* Se sobrescriben los estilos de renderCategoryFilters en JS para dar un toque m√°s moderno */
            border: 1px solid #00796b;
            color: #00796b;
            border-radius: 20px;
            /* Bordes redondeados tipo p√≠ldora */
            padding: 6px 15px;
            transition: all 0.2s;
        }

        #category-filters button.bg-indigo-200 {
            /* Clase para el bot√≥n activo */
            background-color: #00796b !important;
            color: white !important;
        }

        /* El cat√°logo siempre debe verse, pero usaremos showView en JS */
        #catalog-view {
            display: block;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
</head>

<body class="bg-gray-100 min-h-screen p-4">

    <div class="fixed top-0 right-0 m-4 space-x-2 z-50">
        <button id="view-catalog-btn"
            class="px-4 py-2 bg-[#006064] text-white rounded hover:bg-[#004d50] shadow-lg">
            Ver Cat√°logo
        </button>
        <button id="view-cart-btn" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 shadow-lg">
            üõí Carrito (<span id="cart-count">0</span>)
        </button>
        <button id="admin-btn" class="px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700 shadow-lg"
            onclick="showView('admin-login')">
            Admin
        </button>
    </div>

    <main class="max-w-7xl mx-auto mt-16">

        <section id="catalog-view" class="app-view bg-white p-6 rounded-lg shadow-xl">
            <div id="catalog-header">
                <h1 class="text-3xl font-bold mb-4">Cat√°logo de Productos JM.ELECTRONICA</h1>
            </div>

            <div id="category-filters" class="mb-4 space-x-2">
                </div>

            <div id="product-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
                </div>
        </section>


        <section id="admin-login" class="app-view max-w-md mx-auto bg-white p-6 rounded-lg shadow-xl"
            style="display: none;">
            <h2 class="text-2xl font-bold mb-4">Acceso de Administrador</h2>
            <form id="admin-login-form">
                <input type="email" id="admin-email" placeholder="Email" class="w-full p-2 mb-3 border rounded">
                <input type="password" id="admin-password" placeholder="Contrase√±a"
                    class="w-full p-2 mb-3 border rounded">
                <button type="submit" id="login-btn"
                    class="w-full bg-[#006064] text-white p-2 rounded hover:bg-[#004d50]">Ingresar</button>
                <p id="login-message" class="text-red-600 mt-2"></p>
            </form>
            <button onclick="showView('catalog-view')"
                class="mt-4 w-full bg-gray-400 text-white p-2 rounded hover:bg-gray-500">Volver al Cat√°logo</button>
        </section>


        <section id="admin-panel" class="app-view bg-white p-6 rounded-lg shadow-xl" style="display: none;">
            <h2 class="text-2xl font-bold mb-4">Gesti√≥n de Productos</h2>
            <button onclick="handleAdminLogout()"
                class="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600 mb-4">Cerrar Sesi√≥n</button>

            <div id="product-form-container" class="mb-6 border p-4 rounded">
                <h3 id="product-form-title" class="text-xl font-semibold mb-3">Crear Nuevo Producto</h3>
                <form id="product-form">
                    <input type="hidden" id="product-id">
                    <input type="text" id="product-name" placeholder="Nombre del Producto" required>
                    <textarea id="product-description" placeholder="Descripci√≥n breve"></textarea>
                    <input type="number" id="product-price" placeholder="Precio (ej. 19.99)" step="0.01" required>
                    <input type="text" id="product-category" placeholder="Categor√≠a (ej. M√≥dulos)"
                        list="category-options" required>
                    <datalist id="category-options"></datalist>
                    <input type="url" id="product-image" placeholder="URL de la imagen">

                    <div class="flex space-x-2">
                        <button type="submit" id="submit-product-btn"
                            class="flex-1 bg-[#006064] text-white p-2 rounded hover:bg-[#004d50]">Guardar Producto</button>
                        <button type="button" id="cancel-edit-btn" onclick="resetForm()" style="display: none;"
                            class="bg-gray-400 text-white p-2 rounded hover:bg-gray-500">Cancelar Edici√≥n</button>
                    </div>
                </form>
            </div>

            <h3 class="text-xl font-semibold mb-3">Listado y Edici√≥n</h3>
            <input type="text" id="admin-search-input" onkeyup="handleAdminSearch()"
                placeholder="Buscar por nombre o categor√≠a..." class="w-full p-2 mb-4 border rounded">

            <div class="overflow-x-auto">
                <table id="admin-products-table">
                    <thead>
                        <tr class="bg-gray-100">
                            <th>Nombre</th>
                            <th>Precio</th>
                            <th>Categor√≠a</th>
                            <th>Estado</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="admin-product-list">
                        </tbody>
                </table>
            </div>
        </section>


    </main>

    <div id="cart-modal"
        class="hidden fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50">
        <div id="cart-content" class="bg-white p-6 rounded-lg shadow-2xl w-full max-w-md">
            <h3 class="text-2xl font-bold mb-4">Carrito de Pedido</h3>
            <div id="cart-items-list" class="mb-4 max-h-80 overflow-y-auto space-y-3">
                </div>
            <p class="text-xl font-bold mb-4">Total: <span id="cart-total">$0.00</span></p>

            <div class="space-y-2">
                <button onclick="initNameInput('whatsapp')" id="whatsapp-order-btn" disabled
                    class="w-full bg-green-600 text-white p-3 rounded hover:bg-green-700 disabled:bg-gray-400">
                    Enviar Pedido por WhatsApp
                </button>
                <button onclick="initNameInput('email')" id="email-order-btn" disabled
                    class="w-full bg-[#006064] text-white p-3 rounded hover:bg-[#004d50] disabled:bg-gray-400">
                    Enviar Pedido por Email
                </button>
                <button onclick="initNameInput('pdf')" id="pdf-order-btn" disabled
                    class="w-full bg-red-700 text-white p-3 rounded hover:bg-red-800 disabled:bg-gray-400">
                    Descargar Pedido (PDF)
                </button>
                <button onclick="hideModal()"
                    class="w-full bg-gray-300 text-gray-800 p-3 rounded hover:bg-gray-400">Cerrar</button>
            </div>
        </div>
    </div>

    <div id="name-input-modal"
        class="hidden fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-[51]">
        <div class="bg-white p-6 rounded-lg shadow-2xl w-full max-w-sm">
            <h3 class="text-xl font-bold mb-4">Ingresa tu Nombre / Empresa</h3>
            <form id="name-input-form" data-action="">
                <input type="text" id="customer-name" placeholder="Ej: Juan P√©rez o Mi Empresa S.A."
                    class="w-full p-2 mb-4 border rounded" required>
                <div class="flex space-x-2">
                    <button type="submit" id="confirm-name-btn"
                        class="flex-1 bg-[#006064] text-white p-2 rounded hover:bg-[#004d50]">Confirmar</button>
                    <button type="button" id="cancel-name-btn"
                        class="bg-gray-400 text-white p-2 rounded hover:bg-gray-500">Cancelar</button>
                </div>
            </form>
        </div>
    </div>


    <script>
        // ====================================================================
        // 1. CONSTANTES Y ESTADO GLOBAL
        // ====================================================================

        // --- CONSTANTES ---
        const TEST_EMAIL = "admin@test.com";
        const TEST_PASS = "1234";
        const ADMIN_STATE_KEY = "isAdminLoggedIn";
        const CART_STORAGE_KEY = "shoppingCart";
        const PRODUCTS_STORAGE_KEY = "products";
        // TU N√öMERO DE WHATSAPP CONFIGURADO (5493571536378)
        const WHATSAPP_NUMBER = '5493571536378';

        // --- ESTADO ---
        let products = [];
        let cart = {};
        let isHardcodedAdmin = false;
        let activeCategory = 'all';


        // ====================================================================
        // 2. UTILIDADES GENERALES
        // ====================================================================

        /** Cambia la vista activa */
        function showView(viewId) {
            document.querySelectorAll('section').forEach(view => {
                // Solo ocultar las secciones que son 'app-view'
                if (view.classList.contains('app-view')) {
                    view.style.display = 'none';
                }
            });
            const targetView = document.getElementById(viewId);
            if (targetView) {
                targetView.style.display = 'block';
            }
        }

        /** Muestra un di√°logo/alerta simple */
        function showDialog(title, message, callback = null, confirmText = "Aceptar") {
            if (callback) {
                const confirmed = confirm(`${title}\n${message}`);
                callback(confirmed);
            } else {
                alert(`${title}\n${message}`);
            }
        }

        /** Genera IDs √∫nicos (simulaci√≥n) */
        function generateUniqueId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        // ====================================================================
        // 3. PERSISTENCIA DE DATOS (localStorage)
        // ====================================================================

        // Datos de prueba (para el primer inicio si no hay nada en localStorage)
        // ESTA LISTA DEBE CONTENER TODOS TUS PRODUCTOS PUBLICADOS
        const DEFAULT_PRODUCTS = [
            { id: generateUniqueId(), name: "Resistencia 10K", description: "Resistencia de pel√≠cula de carbono.", price: 0.10, category: "Componentes", image: "https://via.placeholder.com/150?text=R10K", active: true },
            { id: generateUniqueId(), name: "Arduino UNO", description: "Placa de desarrollo microcontrolador.", price: 5.99, category: "Placas", image: "https://via.placeholder.com/150?text=Arduino", active: true },
            { id: generateUniqueId(), name: "Protoboard 400p", description: "Placa para prototipado.", price: 1.50, category: "Herramientas", image: "https://via.placeholder.com/150?text=Proto", active: false }
            // Si quieres publicar tus productos: COPIA el JSON del panel de Admin y p√©galo aqu√≠.
        ];

        function loadInitialData() {
            // 1. Cargar Productos
            // Intentamos cargar los cambios que hiciste en la memoria local (tu PC)
            const storedProducts = localStorage.getItem(PRODUCTS_STORAGE_KEY);

            if (storedProducts) {
                // SI HAY DATOS EN TU PC (TUS CAMBIOS), CARGAMOS ESOS.
                products = JSON.parse(storedProducts);
            } else {
                // SI NO HAY DATOS (PRIMER INICIO), USAMOS LOS DEL C√ìDIGO (PUBLICADOS).
                products = DEFAULT_PRODUCTS;
                // Al inicio, guardamos los productos por defecto para que el Admin Panel funcione.
                saveProducts();
            }

            // 2. Cargar Carrito
            const storedCart = localStorage.getItem(CART_STORAGE_KEY);
            cart = storedCart ? JSON.parse(storedCart) : {};

            // 3. Cargar estado de Admin
            isHardcodedAdmin = sessionStorage.getItem(ADMIN_STATE_KEY) === 'true';
        }

        function saveProducts() {
            // Guarda los productos editados en tu localStorage para que el panel los recuerde (cambios privados).
            localStorage.setItem(PRODUCTS_STORAGE_KEY, JSON.stringify(products));
        }

        function saveCart() {
            localStorage.setItem(CART_STORAGE_KEY, JSON.stringify(cart));
        }


        // ====================================================================
        // 4. L√ìGICA CRUD ADMIN
        // ====================================================================

        /** Maneja la creaci√≥n y actualizaci√≥n de productos. */
        function saveProduct(event) {
            event.preventDefault();

            const id = document.getElementById('product-id').value;
            const name = document.getElementById('product-name').value.trim();
            const description = document.getElementById('product-description').value.trim();
            const price = parseFloat(document.getElementById('product-price').value);
            const category = document.getElementById('product-category').value.trim();
            const image = document.getElementById('product-image').value.trim() || 'https://via.placeholder.com/150?text=Sin+Imagen';

            if (!name || !price || isNaN(price) || !category) {
                showDialog("Error", "El nombre, precio y categor√≠a son obligatorios.");
                return;
            }

            if (id) {
                // Editar Producto
                const index = products.findIndex(p => p.id === id);
                if (index !== -1) {
                    products[index] = { ...products[index], name, description, price, category, image };
                    showDialog("√âxito", `Producto '${name}' actualizado.`);
                }
            } else {
                // Crear Nuevo Producto
                const newProduct = {
                    id: generateUniqueId(),
                    name, description, price, category, image, active: true
                };
                products.push(newProduct);
                showDialog("√âxito", `Producto '${name}' creado.`);
            }

            saveProducts(); // Guarda en tu PC
            resetForm();
            renderAdminProducts(products);
            renderCategoryFilters(products);
            renderCatalog(products);
        }

        /** Prepara el formulario para editar un producto. */
        function editProduct(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;

            document.getElementById('product-id').value = product.id;
            document.getElementById('product-name').value = product.name;
            document.getElementById('product-description').value = product.description;
            document.getElementById('product-price').value = product.price;
            document.getElementById('product-category').value = product.category;
            document.getElementById('product-image').value = product.image.includes('Sin+Imagen') ? '' : product.image;

            document.getElementById('product-form-title').textContent = 'Editar Producto Existente';
            document.getElementById('submit-product-btn').textContent = 'Actualizar Producto';
            document.getElementById('cancel-edit-btn').style.display = 'inline';
        }

        /** Restablece el formulario de producto. */
        function resetForm() {
            document.getElementById('product-form').reset();
            document.getElementById('product-id').value = '';
            document.getElementById('product-form-title').textContent = 'Crear Nuevo Producto';
            document.getElementById('submit-product-btn').textContent = 'Guardar Producto';
            document.getElementById('cancel-edit-btn').style.display = 'none';
        }

        /** Elimina un producto. */
        function deleteProduct(productId) {
            showDialog("Confirmar", "¬øEliminar permanentemente?", (confirmed) => {
                if (confirmed) {
                    products = products.filter(p => p.id !== productId);
                    saveProducts();
                    renderAdminProducts(products);
                    renderCatalog(products);
                }
            });
        }

        /** Alterna el estado (Activo/Pausado) de un producto. */
        function toggleProductStatus(productId, currentStatus) {
            const action = currentStatus ? "pausar" : "activar";
            showDialog("Confirmar", `¬øDesea ${action} el producto?`, (confirmed) => {
                if (confirmed) {
                    const product = products.find(p => p.id === productId);
                    if (product) {
                        product.active = !product.active;
                        saveProducts();
                        renderAdminProducts(products);
                        renderCatalog(products);
                    }
                }
            });
        }

        // ====================================================================
        // 5. L√ìGICA DE B√öSQUEDA Y RENDERING ADMIN
        // ====================================================================

        /** Maneja la b√∫squeda en el panel de administraci√≥n */
        function handleAdminSearch() {
            const input = document.getElementById('admin-search-input');
            const searchTerm = input.value.trim();
            renderAdminProducts(products, searchTerm);
        }

        /** Renderiza la tabla de productos para el administrador. */
        function renderAdminProducts(allProducts, searchTerm = '') {
            const tbody = document.getElementById('admin-product-list');

            // 1. Filtrar
            let filteredProducts = allProducts;
            if (searchTerm) {
                const lowerCaseSearch = searchTerm.toLowerCase();
                filteredProducts = allProducts.filter(p =>
                    p.name.toLowerCase().includes(lowerCaseSearch) ||
                    p.category.toLowerCase().includes(lowerCaseSearch)
                );
            }

            // 2. Ordenar Alfab√©ticamente por Nombre
            filteredProducts.sort((a, b) => a.name.localeCompare(b.name));

            if (filteredProducts.length === 0) {
                tbody.innerHTML = `<tr><td colspan="5" style="text-align: center;">No hay productos ${searchTerm ? 'que coincidan con la b√∫squeda.' : 'en la lista.'}</td></tr>`;
                return;
            }

            // 3. Generar HTML
            const rows = filteredProducts.map(p => `
                <tr style="background-color: ${p.active ? '#fff' : '#ffeeee'};">
                    <td>${p.name}</td>
                    <td>$${p.price.toFixed(2)}</td>
                    <td>${p.category}</td>
                    <td>${p.active ? '‚úÖ Activo' : '‚ùå Pausado'}</td>
                    <td class="flex flex-wrap space-x-1">
                        <button onclick="editProduct('${p.id}')" class="bg-yellow-500 text-white p-1 rounded text-sm mb-1">‚úèÔ∏è Editar</button>
                        <button onclick="toggleProductStatus('${p.id}', ${p.active})" class="bg-gray-500 text-white p-1 rounded text-sm mb-1">${p.active ? '‚è∏Ô∏è Pausar' : '‚ñ∂Ô∏è Activar'}</button>
                        <button onclick="deleteProduct('${p.id}')" class="bg-red-500 text-white p-1 rounded text-sm mb-1">üóëÔ∏è Eliminar</button>
                    </td>
                </tr>
            `).join('');

            tbody.innerHTML = rows;
            renderCategoryDatalist(allProducts); // Actualizar opciones del formulario
        }

        /** Renderiza las opciones de categor√≠a para el campo 'datalist'. */
        function renderCategoryDatalist(allProducts) {
            const datalist = document.getElementById('category-options');
            if (!datalist) return;

            // Obtener categor√≠as √∫nicas de todos los productos
            const categoriesSet = new Set(allProducts.map(p => p.category).filter(c => c));
            let optionsHtml = '';

            Array.from(categoriesSet).sort().forEach(category => {
                optionsHtml += `<option value="${category}"></option>`;
            });
            datalist.innerHTML = optionsHtml;
        }

        // ====================================================================
        // 6. RENDERIZADO CAT√ÅLOGO (CLIENTE)
        // ====================================================================

        /** Maneja el cambio de filtro de categor√≠a. */
        function handleFilterChange(category) {
            activeCategory = category;

            // Opcional: Resaltar visualmente el bot√≥n activo
            document.querySelectorAll('#category-filters button').forEach(btn => {
                btn.classList.remove('bg-indigo-200', 'font-bold');
                btn.classList.add('bg-white', 'hover:bg-gray-100');
                if (btn.dataset.category === category) {
                    // Usamos las clases de color del CSS para los botones de categor√≠a.
                    btn.classList.remove('bg-white', 'hover:bg-gray-100');
                    btn.classList.add('bg-indigo-200', 'font-bold');
                }
            });

            renderCatalog(products);
        }

        /** Renderiza los botones de filtro del cat√°logo. */
        function renderCategoryFilters(allProducts) {
            const container = document.getElementById('category-filters');
            if (!container) return;

            // Obtener categor√≠as √∫nicas de productos activos
            const categoriesSet = new Set(allProducts
                .filter(p => p.active)
                .map(p => p.category ? p.category.trim() : null)
                .filter(c => c)
            );

            // Aseguramos que el bot√≥n de 'Todas' se renderice con la clase correcta
            let buttonsHtml = `<button data-category="all" onclick="handleFilterChange('all')" class="${activeCategory === 'all' ? 'bg-indigo-200 font-bold' : 'bg-white hover:bg-gray-100'}">Todas</button>`;

            Array.from(categoriesSet).sort().forEach(category => {
                const sanitizedCategory = category.replace(/'/g, "\\'");
                const isActive = activeCategory === category;
                // Los estilos de color se aplican desde el CSS en la etiqueta <style>
                buttonsHtml += `<button data-category="${category}" onclick="handleFilterChange('${sanitizedCategory}')" class="${isActive ? 'bg-indigo-200 font-bold' : 'bg-white hover:bg-gray-100'}">${category}</button>`;
            });

            container.innerHTML = buttonsHtml;
        }

        /** Renderiza las tarjetas de producto en el cat√°logo. */
        function renderCatalog(allProducts) {
            const grid = document.getElementById('product-grid');

            const activeProducts = allProducts.filter(p => p.active);

            let filteredProducts = activeProducts;
            if (activeCategory !== 'all') {
                filteredProducts = activeProducts.filter(p => p.category === activeCategory);
            }

            // Si no hay productos activos o filtrados
            if (filteredProducts.length === 0) {
                grid.innerHTML = `<p class="col-span-full text-center text-gray-500">No hay productos disponibles ${activeCategory !== 'all' ? `en la categor√≠a '${activeCategory}'` : ''}.</p>`;
                return;
            }

            const productCards = filteredProducts.map(p => `
                <div class="product-card border p-4 rounded-lg shadow-md flex flex-col space-y-2">
                    <img src="${p.image}" alt="${p.name}" class="w-full h-56 object-cover rounded-md">
                    <h4 class="text-lg font-bold">${p.name}</h4>
                    <p class="text-xl font-extrabold text-green-600">$${p.price.toFixed(2)}</p>
                    <button onclick="addToCart('${p.id}', '${p.name.replace(/'/g, "\\'")}', ${p.price})"
                        class="mt-auto bg-[#006064] text-white p-2 rounded hover:bg-[#004d50]">
                        üõçÔ∏è A√±adir al Carrito
                    </button>
                </div>
            `).join('');

            grid.innerHTML = productCards;
        }


        // ====================================================================
        // 7. L√ìGICA DE AUTENTICACI√ìN ADMIN
        // ====================================================================

        /** Intenta iniciar sesi√≥n como administrador. */
        function handleAdminLogin(event) {
            event.preventDefault();
            const email = document.getElementById('admin-email').value;
            const password = document.getElementById('admin-password').value;
            const messageElement = document.getElementById('login-message');

            if (email === TEST_EMAIL && password === TEST_PASS) {
                sessionStorage.setItem(ADMIN_STATE_KEY, 'true');
                isHardcodedAdmin = true;
                showView('admin-panel');
                renderAdminProducts(products);
            } else {
                messageElement.textContent = "Error: Credenciales incorrectas.";
            }
        }

        /** Cierra la sesi√≥n del administrador. */
        function handleAdminLogout() {
            showDialog("Confirmar", "¬øDesea cerrar su sesi√≥n?", (confirmed) => {
                if (confirmed) {
                    sessionStorage.removeItem(ADMIN_STATE_KEY);
                    isHardcodedAdmin = false;
                    showView('admin-login');
                }
            });
        }


        // ====================================================================
        // 8. L√ìGICA DEL CARRITO y EXPORTACI√ìN
        // ====================================================================

        /** Muestra u oculta el modal del carrito. */
        function showModal() {
            document.getElementById('cart-modal').classList.remove('hidden');
            document.getElementById('cart-modal').classList.add('flex');
            renderCart();
        }

        function hideModal() {
            document.getElementById('cart-modal').classList.add('hidden');
            document.getElementById('cart-modal').classList.remove('flex');
            hideNameInputModal();
        }

        function initNameInput(action) {
            const form = document.getElementById('name-input-form');
            form.dataset.action = action;
            document.getElementById('cart-modal').classList.add('hidden');
            document.getElementById('name-input-modal').classList.remove('hidden');
            document.getElementById('name-input-modal').classList.add('flex');
        }

        function hideNameInputModal() {
            document.getElementById('name-input-modal').classList.add('hidden');
            document.getElementById('name-input-modal').classList.remove('flex');
        }

        /** Agrega un producto al carrito. */
        function addToCart(id, name, price) {
            // Verificar si el producto a√∫n existe en la lista de productos activos
            const productExists = products.find(p => p.id === id && p.active);
            if (!productExists) {
                showDialog("Error", `El producto "${name}" no est√° disponible o ha sido desactivado.`);
                return;
            }

            if (cart[id]) {
                cart[id].quantity += 1;
            } else {
                cart[id] = { id, name, price, quantity: 1 };
            }
            saveCart();
            updateCartUI();
        }

        /** Actualiza el contador del carrito. */
        function updateCartUI() {
            const count = Object.values(cart).reduce((total, item) => total + item.quantity, 0);
            document.getElementById('cart-count').textContent = count;

            const disabled = count === 0;
            document.getElementById('whatsapp-order-btn').disabled = disabled;
            document.getElementById('email-order-btn').disabled = disabled;
            document.getElementById('pdf-order-btn').disabled = disabled;
        }

        /** Genera el mensaje de pedido para WhatsApp/Email. */
        function generateOrderMessage(customerName) {
            const cartItems = Object.values(cart);
            let total = 0;

            let message = `¬°Hola! Soy ${customerName} y me gustar√≠a hacer el siguiente pedido:\n\n`;

            cartItems.forEach(item => {
                const subtotal = item.price * item.quantity;
                total += subtotal;
                message += `${item.quantity} x ${item.name} ($${item.price.toFixed(2)} c/u) - Subtotal: $${subtotal.toFixed(2)}\n`;
            });

            message += `\nTotal Final: $${total.toFixed(2)}\n\n`;
            message += `Gracias!`;

            return message;
        }

        /** Renderiza la lista de √≠tems dentro del modal del carrito. */
        function renderCart() {
            const list = document.getElementById('cart-items-list');
            const totalElement = document.getElementById('cart-total');
            let total = 0;
            let cartHtml = '';

            const cartItems = Object.values(cart);

            if (cartItems.length === 0) {
                cartHtml = `<p class="text-center text-gray-500">¬°El carrito est√° vac√≠o!</p>`;
            }
            // Muestra los √≠tems del carrito
            else {
                cartItems.forEach(item => {
                    const subtotal = item.price * item.quantity;
                    total += subtotal;

                    cartHtml += `
                        <div class="border p-3 rounded flex justify-between items-center bg-gray-50">
                            <span class="flex-1">${item.name} (${item.quantity} x $${item.price.toFixed(2)})</span>
                            <span class="font-semibold mx-3">$${subtotal.toFixed(2)}</span>
                            <div class="space-x-1">
                                <button onclick="updateCartQuantity('${item.id}', -1)" class="bg-red-400 text-white w-6 h-6 rounded-full">-</button>
                                <button onclick="updateCartQuantity('${item.id}', 1)" class="bg-green-400 text-white w-6 h-6 rounded-full">+</button>
                            </div>
                        </div>
                    `;
                });
            }

            list.innerHTML = cartHtml;
            totalElement.textContent = `$${total.toFixed(2)}`;
        }

        /** Actualiza la cantidad de un √≠tem en el carrito. */
        function updateCartQuantity(id, change) {
            if (cart[id]) {
                cart[id].quantity += change;
                if (cart[id].quantity <= 0) {
                    delete cart[id];
                }
                saveCart();
                renderCart();
                updateCartUI();
            }
        }

        /** Genera y descarga el PDF. */
        function generatePDF(customerName) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const date = new Date().toLocaleDateString();

            doc.text(`Pedido de: ${customerName}`, 14, 20);
            doc.text(`Fecha: ${date}`, 14, 28);

            const cartItems = Object.values(cart);
            let total = 0;

            const tableData = cartItems.map(item => {
                const subtotal = item.price * item.quantity;
                total += subtotal;
                return [
                    item.name,
                    item.quantity,
                    `$${item.price.toFixed(2)}`,
                    `$${subtotal.toFixed(2)}`
                ];
            });

            doc.autoTable({
                startY: 35,
                head: [['Producto', 'Cantidad', 'Precio Unitario', 'Subtotal']],
                body: tableData,
                foot: [['', '', 'TOTAL:', `$${total.toFixed(2)}`]],
                footStyles: { fillColor: [200, 200, 200], fontSize: 12, textColor: [0, 0, 0], fontStyle: 'bold' }
            });

            doc.save(`Pedido_${customerName.replace(/ /g, '_')}_${date.replace(/\//g, '-')}.pdf`);

            // Limpiar el carrito
            cart = {};
            saveCart();
            updateCartUI();
            hideModal();
            showDialog("PDF Descargado", "El pedido se ha descargado y el carrito se ha vaciado.");
        }


        // ====================================================================
        // 9. INICIALIZACI√ìN
        // ====================================================================

        /** Inicializa la aplicaci√≥n al cargar el DOM. */
        function initApp() {
            loadInitialData();
            updateCartUI();

            // Vistas principales
            document.getElementById('view-catalog-btn').addEventListener('click', () => showView('catalog-view'));
            document.getElementById('view-cart-btn').addEventListener('click', showModal);

            // Enlazar formularios y botones principales
            document.getElementById('product-form').addEventListener('submit', saveProduct);
            document.getElementById('admin-login-form').addEventListener('submit', handleAdminLogin);

            // Manejo del formulario de nombre
            document.getElementById('name-input-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const customerName = document.getElementById('customer-name').value;
                const actionType = e.target.dataset.action;

                hideNameInputModal();

                const message = generateOrderMessage(customerName);

                if (actionType === 'whatsapp') {
                    const encodedMessage = encodeURIComponent(message);
                    const whatsappUrl = WHATSAPP_NUMBER
                        ? `https://wa.me/${WHATSAPP_NUMBER}?text=${encodedMessage}`
                        : `https://wa.me/?text=${encodedMessage}`; // Si no hay n√∫mero, permite al cliente elegir

                    window.open(whatsappUrl, '_blank');

                    // Limpiar el carrito despu√©s de enviar
                    cart = {};
                    saveCart();
                    updateCartUI();
                    showDialog("Pedido Enviado", "Hemos generado su mensaje de pedido. Por favor, env√≠elo por WhatsApp.");
                } else if (actionType === 'email') {
                    const subject = encodeURIComponent('Pedido desde JM.ELECTRONICA');
                    const body = encodeURIComponent(message);
                    window.open(`mailto:?subject=${subject}&body=${body}`, '_blank');
                    // Limpiar el carrito despu√©s de enviar
                    cart = {};
                    saveCart();
                    updateCartUI();
                    showDialog("Email Generado", "Se ha abierto tu cliente de correo. El carrito se ha vaciado.");
                } else if (actionType === 'pdf') {
                    generatePDF(customerName);
                }
            });

            document.getElementById('cancel-name-btn').addEventListener('click', () => {
                hideNameInputModal();
                showModal(); // Volver al carrito
            });

            // Iniciar la vista principal
            if (isHardcodedAdmin) {
                showView('admin-panel');
                renderAdminProducts(products);
            } else {
                showView('catalog-view');
            }

            renderCategoryFilters(products);
            renderCatalog(products);
        }

        document.addEventListener('DOMContentLoaded', initApp);

        // 10. EXPOSICI√ìN GLOBAL (para el HTML)
        window.showView = showView;
        window.showModal = showModal;
        window.hideModal = hideModal;
        window.initNameInput = initNameInput;
        window.handleAdminLogin = handleAdminLogin;
        window.handleAdminLogout = handleAdminLogout;
        window.saveProduct = saveProduct;
        window.editProduct = editProduct;
        window.resetForm = resetForm;
        window.deleteProduct = deleteProduct;
        window.toggleProductStatus = toggleProductStatus;
        window.handleAdminSearch = handleAdminSearch;
        window.handleFilterChange = handleFilterChange;
        window.addToCart = addToCart;
        window.updateCartQuantity = updateCartQuantity;
    </script>
</body>

</html>